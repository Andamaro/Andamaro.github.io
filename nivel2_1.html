<!DOCTYPE html>
<html lang="es">

<head>
  <meta charset="UTF-8" />
  <title>Nivel 2-1: Fracciones visuales</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
  <link href="https://fonts.googleapis.com/css2?family=Palanquin+Dark&display=swap" rel="stylesheet">
  <style>
    body {
      font-family: 'Palanquin Dark', sans-serif;
      background-color: #171B2A;
      color: white;
      margin: 0;
      padding: 0;
    }
.top-bar {
      background-color: #212638;
      display: flex;
      align-items: center;
      justify-content: center;
      height: 50px;
      box-shadow: 0 2px 4px rgba(0,0,0,0.3);
    }

    .top-bar img {
      max-height: 40px;
    }
    .progress-bar {
      width: 100%;
      background-color: #444;
      height: 20px;
    }

    .progress {
      height: 100%;
      width: 0%;
      background-color: #27ae60;
      transition: width 0.4s ease-in-out;
    }

    .container {
      padding: 24px 20px;
      max-width: 500px;
      margin: 0 auto;
    }

    .ejercicio {
      display: none;
      animation: fadeIn 0.3s ease-in-out;
    }

    .ejercicio.active {
      display: block;
    }

    h2 {
      font-size: 1.3em;
      text-align: center;
    }

    p {
      text-align: center;
    }

    input {
      display: block;
      margin: 10px auto;
      padding: 10px;
      font-size: 1em;
      border-radius: 6px;
      border: none;
      width: 60%;
      text-align: center;
    }

    button {
      display: block;
      margin: 20px auto 0;
      background-color: #3690F7;
      color: white;
      border: none;
      border-radius: 8px;
      padding: 12px 20px;
      font-size: 1em;
      cursor: pointer;
      transition: background 0.3s;
    }

    button:hover {
      background-color: #4aa4ff;
    }

    @keyframes fadeIn {
      from {
        opacity: 0;
        transform: translateY(10px);
      }

      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    .mensaje {
      text-align: center;
      font-weight: bold;
      margin-top: 10px;
    }

    .mensaje.correcto {
      color: #27ae60;
    }

    .mensaje.incorrecto {
      color: #e74c3c;
    }
  </style>
</head>
<body>
 <div class="top-bar">
    <img src="logo_enc.png" alt="FracVisual" style="max-height: 40px; max-width: 90%; object-fit: contain;">
  </div>
  <div class="progress-bar">
    <div id="progress" class="progress"></div>
  </div>

  <div class="container">
    <!-- Ejercicio 1: 1/2 -->
    <div class="ejercicio active">
      <h2>üç∞ ¬øQu√© fracci√≥n representa este c√≠rculo?</h2>
      <div class="pastel" style="
            width:200px; height:200px; border-radius:50%;
            margin:20px auto;
            background: conic-gradient(#3690F7 50%, #212638 0 100%);
            position: relative;">
        <div style="
              position:absolute; top:50%; left:50%;
              transform:translate(-50%, -50%);
              color:white; font-size:1.2em;">
          ?
        </div>
      </div>
      <input type="text" placeholder="Ej. 1/2" />
      <div class="mensaje"></div>
      <button onclick="verificar(0)">Verificar</button>
    </div>

    <!-- Ejercicio 2: 3/4 -->
    <div class="ejercicio">
      <h2>üçï ¬øQu√© fracci√≥n representa este c√≠rculo?</h2>
      <div class="pastel" style="
            width:200px; height:200px; border-radius:50%;
            margin:20px auto;
            background: conic-gradient(#3690F7 75%, #212638 0 100%);
            position: relative;">
        <div style="
              position:absolute; top:50%; left:50%;
              transform:translate(-50%, -50%);
              color:white; font-size:1.2em;">
          ?
        </div>
      </div>
      <input type="text"  />
      <div class="mensaje"></div>
      <button onclick="verificar(1)">Verificar</button>
    </div>

    <!-- Ejercicio 3: 2/3 -->
    <div class="ejercicio">
      <h2>¬øQu√© fracci√≥n representa este c√≠rculo?</h2>
      <div class="pastel" style="
            width:200px; height:200px; border-radius:50%;
            margin:20px auto;
            background: conic-gradient(#3690F7 66.6667%, #212638 0 100%);
            position: relative;">
        <div style="
              position:absolute; top:50%; left:50%;
              transform:translate(-50%, -50%);
              color:white; font-size:1.2em;">
          ?
        </div>
      </div>
      <input type="text"  />
      <div class="mensaje"></div>
      <button onclick="verificar(2)">Verificar</button>
    </div>

    <!-- Final -->
    <div class="ejercicio" id="final" style="display:none;">
      <h2>¬°Nivel completado! üéâ</h2>
      <p>¬°Muy bien! Has entendido las fracciones visuales.</p>
      <button id="volverInicio">Volver al inicio</button>
    </div>
  </div>

  <!-- Audios -->
  <audio id="clickAudio" src="Click.mp3" preload="auto"></audio>
  <audio id="victoriaAudio" src="victoria.mp3" preload="auto"></audio>

  <script>
    const ejercicios = document.querySelectorAll('.ejercicio');
    const barra = document.getElementById("progress");
    const audioClick = document.getElementById("clickAudio");
    const audioVictoria = document.getElementById("victoriaAudio");

    // Nuevas respuestas v√°lidas para cada ejercicio:
    const respuestasValidas = [
      // Ejercicio 1: 1/2
      ["1/2", "2/4", "3/6", "4/8", "0.5"],
      // Ejercicio 2: 3/4
      ["3/4", "6/8", "9/12", "0.75"],
      // Ejercicio 3: 2/3
      ["2/3", "4/6", "6/9", "0.66666", "0.6667", "0.67"]
    ];

    let actual = 0;

    function verificar(i) {
      const input = ejercicios[i].querySelector("input");
      const mensaje = ejercicios[i].querySelector(".mensaje");
      let valor = input.value.replace(/\s/g, "").toLowerCase();

      // Normalizar a decimal si es fracci√≥n
      if (valor.includes("/")) {
        const [num, den] = valor.split("/").map(Number);
        if (!isNaN(num) && !isNaN(den) && den !== 0) {
          valor = (num / den).toFixed(4); // mayor precisi√≥n
        }
      }
      // Sonido de clic
      audioClick.currentTime = 0;
      audioClick.play();

      // Preparar comparaciones: convertir cada respuesta v√°lida a decimal con toFixed(4)
      const respuestas = respuestasValidas[i].map(res => {
        if (res.includes("/")) {
          const [n, d] = res.split("/").map(Number);
          if (d !== 0) return (n / d).toFixed(4);
          return res;
        } else {
          // decimal textual, formatear a 4 decimales
          const num = parseFloat(res);
          if (!isNaN(num)) return num.toFixed(4);
          return res;
        }
      });

      // Comparar con cierta tolerancia: consideramos igual si al toFixed(4) coincide
      const valorNorm = parseFloat(valor).toFixed(4);
      if (respuestas.includes(valorNorm)) {
        mensaje.textContent = "¬°Correcto!";
        mensaje.className = "mensaje correcto";

        if (i === ejercicios.length - 2) {
          // √∫ltimo ejercicio antes del final
          audioVictoria.currentTime = 0;
          audioVictoria.play();
        }

        setTimeout(() => {
          siguiente();
        }, 800);
      } else {
        mensaje.textContent = "Int√©ntalo de nuevo";
        mensaje.className = "mensaje incorrecto";
      }
    }

    function siguiente() {
      ejercicios[actual].classList.remove("active");
      actual++;
      if (actual < ejercicios.length - 1) {
        ejercicios[actual].classList.add("active");
      } else {
        ejercicios[actual].style.display = "block";
      }
      actualizarBarra();
    }

    function actualizarBarra() {
      const porcentaje = (actual / (ejercicios.length - 1)) * 100;
      barra.style.width = porcentaje + "%";
    }

    // Reproducir sonido al volver al inicio
    document.getElementById("volverInicio").addEventListener("click", function () {
      audioClick.currentTime = 0;
      audioClick.play();
      setTimeout(() => {
        window.location.href = 'index.html';
      }, 500);
    });

    window.onload = actualizarBarra;
  </script>

</body>
</html>
